<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> | Panel de Administración</title>
  <meta name="description" content="Panel avanzado de administración de servidor Discord - Nebura AI">
  <meta name="keywords" content="Nebura, Discord, Servidor, Dashboard, Estadísticas, Moderación">
  <meta name="author" content="Nebura">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel="stylesheet" href="/css/server.css">
  <script>
    window.serverData = JSON.parse('<%- JSON.stringify(serverData) %>');
    window.user = JSON.parse('<%- JSON.stringify(user) %>');
  </script>
</head>

<body class="dark-theme">
  <!-- Selector de idioma -->
  <div style="position: absolute; top: 18px; right: 24px; z-index: 10;">
    <div class="language-switcher">
      <a href="#" class="lang-link active" data-lang="es">ES</a>
      <span style="color:var(--text-muted-dark);">|</span>
      <a href="#" class="lang-link" data-lang="en">EN</a>
    </div>
  </div>
  <!-- Preloader -->
  <div class="preloader">
    <div class="spinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="spinner-text">Cargando Dashboard...</div>
    </div>
  </div>

  <div id="app-container">
    <div class="d-flex" style="min-height: 100vh; min-width: 100vw;">
      <!-- SIDEBAR MEJORADO -->
      <%- include('partials/sidebar', { user: user }) %>

      <!-- CONTENIDO PRINCIPAL -->
      <main class="flex-grow-1 p-4 main-content">
        <!-- ALERTA DE MANTENIMIENTO DE ADMINISTRACIÓN DEL SERVIDOR -->
        <div class="alert alert-danger alert-dismissible fade show shadow-lg mb-4" role="alert" style="font-size:1.1rem;">
          <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
            <div>
              <strong data-key="maintenanceAlertTitle">¡Atención!</strong>
              <span data-key="maintenanceAlertText">
                Actualmente la sección de <b>administración del servidor</b> está en mantenimiento.<br>
                Algunas funciones avanzadas de gestión y configuración pueden no estar disponibles temporalmente.<br>
                Por favor, mantente pendiente a futuras notificaciones y actualizaciones.<br>
                Si tienes dudas o necesitas soporte, contacta con el equipo de Nebura a través de nuestros canales oficiales.
              </span>
            </div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar" data-key="close"></button>
        </div>

        <!-- HEADER MEJORADO CON MÁS INFORMACIÓN -->
        <div class="admin-header d-flex align-items-center fade-in mb-4" data-aos="fade-down">
          <div class="d-flex align-items-center">
            <% if (serverData.icon) { %>
            <img src="https://cdn.discordapp.com/icons/<%= serverData.id %>/<%= serverData.icon %>.webp?size=256" alt="Icono Servidor" class="admin-avatar me-3 pulse">
            <% } else { %>
            <div class="admin-avatar d-flex align-items-center justify-content-center bg-gradient-primary me-3 pulse" style="font-size:2.5rem;">
              <i class="fas fa-server"></i>
            </div>
            <% } %>
            <div>
              <h1 class="welcome-title mb-1" data-key="serverTitle">Servidor: <strong><%= serverData.name %></strong></h1>
              <div class="d-flex align-items-center flex-wrap">
                <div class="me-3">
                  <span class="badge bg-dark text-light me-1">
                    <i class="fas fa-hashtag me-1"></i>ID: <%= serverData.id %>
                  </span>
                  <span class="badge bg-primary me-1">
                    <i class="fas fa-users me-1"></i><span data-key="members">Miembros</span>: 1,245
                  </span>
                  <span class="badge bg-secondary me-1">
                    <i class="fas fa-calendar-alt me-1"></i><span data-key="registered">Registrado</span>: 05/06/2025
                  </span>
                </div>
              </div>
              <div class="admin-badges mt-2">
                <% if (serverData.levelConfig) { %>
                <span class="badge bg-success-gradient me-2">
                  <i class="fas fa-signal me-1"></i><span data-key="levelSystem">Sistema de Niveles</span>
                </span>
                <% } %>
                <% if (serverData.modLog) { %>
                <span class="badge bg-warning-gradient me-2">
                  <i class="fas fa-clipboard-list me-1"></i><span data-key="modLogActive">ModLog Activo</span>
                </span>
                <% } else { %>
                <span class="badge bg-danger-gradient me-2">
                  <i class="fas fa-exclamation-circle me-1"></i><span data-key="modLogInactive">ModLog No Configurado</span>
                </span>
                <% } %>
                <span class="badge bg-info-gradient">
                  <i class="fab fa-discord me-1"></i>Discord
                </span>
              </div>
            </div>
          </div>
          <div class="ms-auto d-flex">
            <button class="btn btn-primary-gradient me-2 hover-scale" data-bs-toggle="modal" data-bs-target="#quickActionsModal">
              <i class="fas fa-bolt me-1"></i><span data-key="quickActions">Acciones Rápidas</span>
            </button>
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle hover-scale" type="button" id="serverActionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-cog me-1"></i><span data-key="settings">Configuración</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="serverActionsDropdown">
                <li><a class="dropdown-item" href="#"><i class="fas fa-sliders-h me-2"></i><span data-key="generalSettings">Ajustes Generales</span></a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-signal me-2"></i><span data-key="levelSystem">Sistema de Niveles</span></a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-gavel me-2"></i><span data-key="moderation">Moderación</span></a></li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-sign-out-alt me-2"></i><span data-key="leaveServer">Salir del Servidor</span></a></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- PANEL DE ESTADÍSTICAS MEJORADO -->
        <div class="row mb-4 stats-grid">
          <div class="col-xl-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="100">
            <div class="card stat-card bg-primary-gradient hover-float">
              <div class="card-body">
                <div class="stat-title">Miembros</div>
                <div class="stat-value"><%= totalMembers %></div>
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-progress">
                  <div class="progress-bar" style="width: 75%"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="200">
            <div class="card stat-card bg-success-gradient hover-float">
              <div class="card-body">
                <div class="stat-title">Mensajes Totales</div>
                <div class="stat-value"><%= totalMessages %></div>
                <div class="stat-icon"><i class="fas fa-comment-dots"></i></div>
                <div class="stat-progress">
                  <div class="progress-bar" style="width: 65%"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="300">
            <div class="card stat-card bg-warning-gradient hover-float">
              <div class="card-body">
                <div class="stat-title">Economía Total</div>
                <div class="stat-value">$<%= totalEconomy %></div>
                <div class="stat-icon"><i class="fas fa-coins"></i></div>
                <div class="stat-progress">
                  <div class="progress-bar" style="width: 85%"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="400">
            <div class="card stat-card bg-danger-gradient hover-float">
              <div class="card-body">
                <div class="stat-title">Nivel Promedio</div>
                <div class="stat-value"><%= avgLevel %></div>
                <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                <div class="stat-progress">
                  <div class="progress-bar" style="width: 55%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- GRÁFICAS AVANZADAS -->
        <div class="row mb-4">
          <div class="col-lg-8 mb-4" data-aos="fade-right">
            <div class="card h-100 card-hover">
              <div class="card-header d-flex justify-content-between align-items-center">
                <div><i class="fas fa-bolt me-2"></i>Comandos más usados</div>
                <div class="chart-tabs">
                  <button class="btn btn-sm btn-outline-secondary active" data-chart="table">Tabla</button>
                  <button class="btn btn-sm btn-outline-secondary" data-chart="graph">Gráfico</button>
                </div>
              </div>
              <div class="card-body">
                <div class="chart-container" id="commandsChartContainer">
                  <div class="table-view">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>Comando</th>
                            <th>Usos</th>
                            <th>%</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% topCommands.forEach(cmd => { %>
                          <tr>
                            <td><span class="cmd-badge">!</span><%= cmd.name %></td>
                            <td><%= cmd.count %></td>
                            <td>
                              <div class="progress">
                                <div class="progress-bar" style="width: <%= (cmd.count / topCommands[0].count) * 100 %>%"></div>
                              </div>
                            </td>
                          </tr>
                          <% }) %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="graph-view" style="display: none;">
                    <div id="commandsChart"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 mb-4" data-aos="fade-left">
            <div class="card h-100 card-hover">
              <div class="card-header"><i class="fas fa-hashtag me-2"></i>Canales más activos</div>
              <div class="card-body">
                <div id="channelsPieChart"></div>
                <div class="channels-list mt-3">
                  <% topChannels.slice(0, 3).forEach(ch => { %>
                  <div class="channel-item">
                    <div class="channel-info">
                      <div class="channel-name">
                        #<%= channelsMap && channelsMap[ch.id] ? channelsMap[ch.id] : ch.id %>
                      </div>
                      <div class="channel-stats">
                        <div class="stat"><i class="fas fa-comment"></i> <%= ch.count %></div>
                      </div>
                    </div>
                    <div class="progress thin">
                      <div class="progress-bar bg-info" style="width: <%= (ch.count / topChannels[0].count) * 100 %>%;"></div>
                    </div>
                  </div>
                  <% }) %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TABLA DE CONFIGURACIÓN MEJORADA -->
        <div class="card mb-4 fade-in card-hover" data-aos="zoom-in">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <i class="fas fa-cogs me-2"></i> Configuración del Servidor
            </div>
            <div>
              <button class="btn btn-sm btn-primary hover-scale" data-bs-toggle="modal" data-bs-target="#editConfigModal">
                <i class="fas fa-pen me-1"></i>Editar
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover table-config">
                <tbody>
                  <tr>
                    <th>Prefix</th>
                    <td><span class="config-value"><%= serverData.data?.prefix || '!' %></span></td>
                  </tr>
                  <tr>
                    <th>Idioma</th>
                    <td><span class="badge bg-info"><%= serverData.data?.lenguage || 'es' %></span></td>
                  </tr>
                  <tr>
                    <th>Canal de Sugerencias</th>
                    <td><%- serverData.data?.suggestChannel || '<span class="text-muted">No configurado</span>' %></td>
                  </tr>
                  <tr>
                    <th>Footer</th>
                    <td><%- serverData.data?.footerText || '<span class="text-muted">No configurado</span>' %></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- SECCIÓN DE MIEMBROS DESTACADOS -->
        <div class="card mb-4 card-hover" data-aos="fade-up">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <i class="fas fa-users me-2"></i> Miembros Destacados
            </div>
            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="membersFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-filter me-1"></i>Filtrar
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="membersFilterDropdown">
                <li><a class="dropdown-item active" href="#"><i class="fas fa-trophy me-2"></i>Por Nivel</a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-comment me-2"></i>Por Mensajes</a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-coins me-2"></i>Por Economía</a></li>
                <li><a class="dropdown-item" href="#"><i class="fas fa-clock me-2"></i>Por Tiempo</a></li>
              </ul>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover table-members">
                <thead>
                  <tr>
                    <th>Usuario</th>
                    <th>Nivel</th>
                    <th>XP</th>
                    <th>Mensajes</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <% userLevels.forEach(u => { %>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <% if (usersMap && usersMap[u.userId]) { %>
                        <img src="<%= usersMap[u.userId].avatar %>" class="user-avatar me-2">
                        <span><%= usersMap[u.userId].username %></span>
                        <% } else { %>
                        <img src="https://cdn.discordapp.com/embed/avatars/<%= Math.floor(Math.random() * 5) %>.png" class="user-avatar me-2">
                        <span>Usuario#<%= Math.floor(1000 + Math.random() * 9000) %></span>
                        <% } %>
                      </div>
                    </td>
                    <td>
                      <div class="level-badge">
                        <span class="level-number"><%= u.level %></span>
                      </div>
                    </td>
                    <td><%= u.xp %></td>
                    <td><%= u.totalMessages %></td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></button>
                      <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-envelope"></i></button>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div class="text-muted small">
                Mostrando top <%= userLevels.length %> miembros destacados
              </div>
              <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm mb-0">
                  <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
                  </li>
                  <li class="page-item active"><a class="page-link" href="#">1</a></li>
                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                  <li class="page-item"><a class="page-link" href="#">3</a></li>
                  <li class="page-item">
                    <a class="page-link" href="#">Siguiente</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>

        <!-- ACTIVIDAD RECIENTE -->
        <div class="card mb-4 card-hover" data-aos="fade-up">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <i class="fas fa-history me-2"></i> Actividad Reciente
            </div>
            <div>
              <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-sync-alt"></i></button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="activity-timeline">
              <div class="activity-item">
                <div class="activity-icon bg-primary">
                  <i class="fas fa-comment"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-header">
                    <span class="activity-user">Usuario#1234</span>
                    <span class="activity-time">hace 2 minutos</span>
                  </div>
                  <div class="activity-message">Usó el comando !ayuda en #general</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-icon bg-success">
                  <i class="fas fa-level-up-alt"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-header">
                    <span class="activity-user">Usuario#5678</span>
                    <span class="activity-time">hace 15 minutos</span>
                  </div>
                  <div class="activity-message">Subió al nivel 25</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-icon bg-warning">
                  <i class="fas fa-coins"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-header">
                    <span class="activity-user">Usuario#9012</span>
                    <span class="activity-time">hace 1 hora</span>
                  </div>
                  <div class="activity-message">Ganó 250 créditos en el casino</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-icon bg-danger">
                  <i class="fas fa-gavel"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-header">
                    <span class="activity-user">Moderador#3456</span>
                    <span class="activity-time">hace 3 horas</span>
                  </div>
                  <div class="activity-message">Expulsó a Usuario#7890 por spam</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODAL DE ACCIONES RÁPIDAS -->
  <div class="modal fade" id="quickActionsModal" tabindex="-1" aria-labelledby="quickActionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="quickActionsModalLabel">
            <i class="fas fa-bolt me-2"></i>Acciones Rápidas
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <button class="btn btn-action-card w-100 h-100 hover-scale">
                <div class="action-icon bg-primary-gradient">
                  <i class="fas fa-bullhorn"></i>
                </div>
                <div class="action-title">Enviar Anuncio</div>
                <div class="action-desc">Notifica a todos los miembros</div>
              </button>
            </div>
            <div class="col-md-6">
              <button class="btn btn-action-card w-100 h-100 hover-scale">
                <div class="action-icon bg-success-gradient">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div class="action-title">Invitar Usuarios</div>
                <div class="action-desc">Comparte el enlace de invitación</div>
              </button>
            </div>
            <div class="col-md-6">
              <button class="btn btn-action-card w-100 h-100 hover-scale">
                <div class="action-icon bg-warning-gradient">
                  <i class="fas fa-sliders-h"></i>
                </div>
                <div class="action-title">Ajustes Rápidos</div>
                <div class="action-desc">Configuración básica del servidor</div>
              </button>
            </div>
            <div class="col-md-6">
              <button class="btn btn-action-card w-100 h-100 hover-scale">
                <div class="action-icon bg-danger-gradient">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="action-title">Moderación</div>
                <div class="action-desc">Herramientas de moderación</div>
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE EDICIÓN DE CONFIGURACIÓN -->
  <div class="modal fade" id="editConfigModal" tabindex="-1" aria-labelledby="editConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editConfigModalLabel">
            <i class="fas fa-cogs me-2"></i>Editar Configuración del Servidor
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-4" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general-tab-pane" type="button" role="tab">
                <i class="fas fa-cog me-1"></i>General
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="levels-tab" data-bs-toggle="tab" data-bs-target="#levels-tab-pane" type="button" role="tab">
                <i class="fas fa-signal me-1"></i>Sistema de Niveles
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="moderation-tab" data-bs-toggle="tab" data-bs-target="#moderation-tab-pane" type="button" role="tab">
                <i class="fas fa-gavel me-1"></i>Moderación
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced-tab-pane" type="button" role="tab">
                <i class="fas fa-code me-1"></i>Avanzado
              </button>
            </li>
          </ul>
          <div class="tab-content" id="configTabsContent">
            <div class="tab-pane fade show active" id="general-tab-pane" role="tabpanel">
              <div class="mb-3">
                <label for="serverPrefix" class="form-label">Prefijo de Comandos</label>
                <input type="text" class="form-control" id="serverPrefix" value="<%= serverData.data.prefix || '!' %>">
              </div>
              <div class="mb-3">
                <label for="welcomeChannel" class="form-label">Canal de Bienvenida</label>
                <select class="form-select" id="welcomeChannel">
                  <option selected disabled>Seleccionar canal...</option>
                  <option value="1234567890">#general</option>
                  <option value="2345678901">#bienvenidas</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="suggestChannel" class="form-label">Canal de Sugerencias</label>
                <select class="form-select" id="suggestChannel">
                  <option selected disabled>Seleccionar canal...</option>
                  <option value="3456789012">#sugerencias</option>
                  <option value="4567890123">#feedback</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="embedColor" class="form-label">Color de Embeds</label>
                <div class="input-group color-picker-group">
                  <input type="color" class="form-control form-control-color" id="embedColor" value="<%= serverData.data?.embedColor || '#6a5af9' %>" title="Elige un color">
                  <input type="text" class="form-control" value="<%= serverData.data?.embedColor || '#6a5af9' %>">
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="levels-tab-pane" role="tabpanel">
              <div class="mb-3 form-check form-switch">
                <input class="form-check-input" type="checkbox" id="enableLevels" <%= serverData.levelConfig ? 'checked' : '' %>>
                <label class="form-check-label" for="enableLevels">Activar Sistema de Niveles</label>
              </div>
              <div id="levelsConfigSection" <%= !serverData.levelConfig ? 'style="display: none;"' : '' %>>
                <div class="mb-3">
                  <label for="levelsChannel" class="form-label">Canal de Notificaciones</label>
                  <select class="form-select" id="levelsChannel">
                    <option selected disabled>Seleccionar canal...</option>
                    <option value="5678901234" <%= serverData.levelConfig && serverData.levelConfig.channelId === '5678901234' ? 'selected' : '' %>>#niveles</option>
                    <option value="6789012345" <%= serverData.levelConfig && serverData.levelConfig.channelId === '6789012345' ? 'selected' : '' %>>#general</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="maxLevel" class="form-label">Nivel Máximo</label>
                  <input type="number" class="form-control" id="maxLevel" value="<%= serverData.levelConfig ? serverData.levelConfig.maxLevel : '100' %>">
                </div>
                <div class="mb-3">
                  <label class="form-label">Recompensas por Nivel</label>
                  <div class="levels-rewards-container">
                    <div class="levels-rewards-editor" id="levelsRewardsEditor"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="moderation-tab-pane" role="tabpanel">
              <div class="mb-3 form-check form-switch">
                <input class="form-check-input" type="checkbox" id="enableModLog" <%= serverData.modLog ? 'checked' : '' %>>
                <label class="form-check-label" for="enableModLog">Activar ModLog</label>
              </div>
              <div id="modLogConfigSection" <%= !serverData.modLog ? 'style="display: none;"' : '' %>>
                <div class="mb-3">
                  <label for="modLogChannel" class="form-label">Canal de ModLog</label>
                  <select class="form-select" id="modLogChannel">
                    <option selected disabled>Seleccionar canal...</option>
                    <option value="7890123456" <%= serverData.modLog && serverData.modLog.channelId === '7890123456' ? 'selected' : '' %>>#moderación</option>
                    <option value="8901234567" <%= serverData.modLog && serverData.modLog.channelId === '8901234567' ? 'selected' : '' %>>#registros</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Eventos a Registrar</label>
                  <div class="modlog-events-container">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="logBans" checked>
                      <label class="form-check-label" for="logBans">Baneos</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="logKicks" checked>
                      <label class="form-check-label" for="logKicks">Expulsiones</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="logWarns" checked>
                      <label class="form-check-label" for="logWarns">Advertencias</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="logMutes" checked>
                      <label class="form-check-label" for="logMutes">Silencios</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="advanced-tab-pane" role="tabpanel">
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Advertencia:</strong> Los cambios en esta sección pueden afectar el funcionamiento del bot.
              </div>
              <div class="mb-3">
                <label for="advancedConfig" class="form-label">Configuración Avanzada (JSON)</label>
                <textarea class="form-control font-monospace" id="advancedConfig" rows="10"><%= JSON.stringify(serverData, null, 2) %></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICACIONES MEJORADO -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="notificationToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto" id="toast-title">Notificación</strong>
        <small class="text-muted" id="toast-time">justo ahora</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body" id="toast-body">
        Mensaje de notificación
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script>
    // Inicializar AOS (Animate On Scroll)
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });

    // Simular preloader
    window.addEventListener('load', function() {
      setTimeout(function() {
        document.querySelector('.preloader').classList.add('loaded');
        document.querySelector('.main-content').style.opacity = '1';
      }, 1000);
    });

    // Inicializar tooltips
    document.addEventListener('DOMContentLoaded', function() {
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      // Inicializar copiado al portapapeles
      new ClipboardJS('.btn-copy');

      // Mostrar notificación al copiar
      document.querySelectorAll('.btn-copy').forEach(btn => {
        btn.addEventListener('click', function() {
          showToast('Copiado', 'El texto ha sido copiado al portapapeles', 'success');
        });
      });

      // Alternar entre tabla y gráfico de comandos
      document.querySelectorAll('[data-chart]').forEach(btn => {
        btn.addEventListener('click', function() {
          const chartType = this.getAttribute('data-chart');
          document.querySelectorAll('[data-chart]').forEach(b => b.classList.remove('active'));
          this.classList.add('active');

          if (chartType === 'table') {
            document.querySelector('.table-view').style.display = 'block';
            document.querySelector('.graph-view').style.display = 'none';
          } else {
            document.querySelector('.table-view').style.display = 'none';
            document.querySelector('.graph-view').style.display = 'block';
            renderCommandsChart();
          }
        });
      });

      // Configurar gráficas
      if (typeof ApexCharts !== 'undefined') {
        // Gráfica de comandos más usados
        function renderCommandsChart() {
          const commandsChart = new ApexCharts(document.querySelector("#commandsChart"), {
            series: [{
              name: 'Usos',
              data: [120, 98, 76, 65, 54, 43, 32, 21, 10, 8]
            }],
            chart: {
              type: 'bar',
              height: 350,
              toolbar: {
                show: false
              },
              animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800,
                animateGradually: {
                  enabled: true,
                  delay: 150
                },
                dynamicAnimation: {
                  enabled: true,
                  speed: 350
                }
              }
            },
            plotOptions: {
              bar: {
                borderRadius: 4,
                horizontal: true,
                distributed: true,
                barHeight: '80%',
              }
            },
            colors: ['#6a5af9', '#4cc9f0', '#f72585', '#7209b7', '#3a0ca3', '#4361ee', '#4cc9f0', '#4895ef', '#560bad', '#b5179e'],
            dataLabels: {
              enabled: false
            },
            xaxis: {
              categories: ['!ayuda', '!nivel', '!perfil', '!tienda', '!comprar', '!top', '!reportar', '!sugerir', '!info', '!invitar'],
            },
            tooltip: {
              theme: 'dark',
              y: {
                formatter: function(val) {
                  return val + " usos";
                }
              }
            }
          });
          commandsChart.render();
        }

        // Gráfica de canales (pie)
        const channelsPieChart = new ApexCharts(document.querySelector("#channelsPieChart"), {
          series: [35, 25, 20, 10, 5, 5],
          chart: {
            type: 'donut',
            height: 250,
            animations: {
              enabled: true,
              easing: 'easeinout',
              speed: 800,
              animateGradually: {
                enabled: true,
                delay: 150
              },
              dynamicAnimation: {
                enabled: true,
                speed: 350
              }
            }
          },
          labels: ['#general', '#bienvenidas', '#off-topic', '#anuncios', '#sugerencias', '#otros'],
          colors: ['#6a5af9', '#4cc9f0', '#f72585', '#7209b7', '#3a0ca3', '#4361ee'],
          legend: {
            position: 'bottom'
          },
          plotOptions: {
            pie: {
              donut: {
                labels: {
                  show: true,
                  total: {
                    show: true,
                    label: 'Total Mensajes',
                    color: '#fff',
                    formatter: function(w) {
                      return w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                    }
                  }
                }
              }
            }
          },
          responsive: [{
            breakpoint: 480,
            options: {
              chart: {
                width: 200
              },
              legend: {
                position: 'bottom'
              }
            }
          }],
          tooltip: {
            theme: 'dark',
            y: {
              formatter: function(val) {
                return val + " mensajes";
              }
            }
          }
        });
        channelsPieChart.render();
      }

      // Mostrar/ocultar secciones de configuración
      document.getElementById('enableLevels')?.addEventListener('change', function() {
        const section = document.getElementById('levelsConfigSection');
        if (this.checked) {
          section.style.display = 'block';
          section.classList.add('animate__animated', 'animate__fadeIn');
        } else {
          section.style.display = 'none';
        }
      });

      document.getElementById('enableModLog')?.addEventListener('change', function() {
        const section = document.getElementById('modLogConfigSection');
        if (this.checked) {
          section.style.display = 'block';
          section.classList.add('animate__animated', 'animate__fadeIn');
        } else {
          section.style.display = 'none';
        }
      });

      // Efecto hover para botones
      document.querySelectorAll('.hover-scale').forEach(el => {
        el.addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.05)';
        });
        el.addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
        });
      });
    });

    // Función para mostrar notificaciones
    function showToast(title, message, type = 'info') {
      const toastEl = document.getElementById('notificationToast');
      const toastTitle = document.getElementById('toast-title');
      const toastBody = document.getElementById('toast-body');
      const toastTime = document.getElementById('toast-time');

      // Configurar estilo según el tipo
      const toast = new bootstrap.Toast(toastEl);
      const toastHeader = toastEl.querySelector('.toast-header');

      // Resetear clases
      toastHeader.className = 'toast-header';
      toastHeader.classList.add('bg-' + type + '-gradient');

      // Configurar contenido
      toastTitle.textContent = title;
      toastBody.textContent = message;

      // Formatear hora actual
      const now = new Date();
      toastTime.textContent = now.toLocaleTimeString([], {
        hour: '2-digit',
        minute: '2-digit'
      });

      // Mostrar toast
      toast.show();
    }

    // MULTILENGUAJE
    const translations = {
      es: {
        maintenanceAlertTitle: "¡Atención!",
        maintenanceAlertText: "Actualmente la sección de <b>administración del servidor</b> está en mantenimiento.<br>Algunas funciones avanzadas de gestión y configuración pueden no estar disponibles temporalmente.<br>Por favor, mantente pendiente a futuras notificaciones y actualizaciones.<br>Si tienes dudas o necesitas soporte, contacta con el equipo de Nebura a través de nuestros canales oficiales.",
        close: "Cerrar",
        serverTitle: "Servidor:",
        members: "Miembros",
        registered: "Registrado",
        levelSystem: "Sistema de Niveles",
        modLogActive: "ModLog Activo",
        modLogInactive: "ModLog No Configurado",
        quickActions: "Acciones Rápidas",
        settings: "Configuración",
        generalSettings: "Ajustes Generales",
        moderation: "Moderación",
        leaveServer: "Salir del Servidor",
        // Agrega aquí más claves según lo que marques con data-key
      },
      en: {
        maintenanceAlertTitle: "Attention!",
        maintenanceAlertText: "The <b>server administration</b> section is currently under maintenance.<br>Some advanced management and configuration features may be temporarily unavailable.<br>Please stay tuned for future notifications and updates.<br>If you have questions or need support, contact the Nebura team through our official channels.",
        close: "Close",
        serverTitle: "Server:",
        members: "Members",
        registered: "Registered",
        levelSystem: "Level System",
        modLogActive: "ModLog Active",
        modLogInactive: "ModLog Not Configured",
        quickActions: "Quick Actions",
        settings: "Settings",
        generalSettings: "General Settings",
        moderation: "Moderation",
        leaveServer: "Leave Server",
        // Add more keys as needed
      }
    };

    function setLanguage(lang) {
      localStorage.setItem('serverLang', lang);
      document.documentElement.lang = lang;
      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (translations[lang][key]) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = translations[lang][key];
          } else {
            el.innerHTML = translations[lang][key];
          }
        }
      });
      // Actualiza el estado visual del selector
      document.querySelectorAll('.lang-link').forEach(link => {
        link.classList.toggle('active', link.dataset.lang === lang);
      });
    }

    // Inicialización de idioma
    const savedLang = localStorage.getItem('serverLang') || (navigator.language.startsWith('en') ? 'en' : 'es');
    setLanguage(savedLang);

    // Eventos de cambio de idioma
    document.querySelectorAll('.lang-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        setLanguage(this.getAttribute('data-lang'));
      });
    });
  </script>
</body>

</html>