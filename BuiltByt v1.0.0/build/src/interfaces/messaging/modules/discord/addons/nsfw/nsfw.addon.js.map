{"version":3,"file":"nsfw.addon.js","sources":["src/interfaces/messaging/modules/discord/addons/nsfw/nsfw.addon.ts"],"sourceRoot":"/","sourcesContent":["import { ChannelType } from \"discord.js\";\r\nimport fs from \"fs\";\r\n\r\nimport { Addons } from \"@/interfaces/messaging/modules/discord/structure/addons\";\r\nimport { client, main } from \"@/main\";\r\n\r\nimport config from \"./config\";\r\n\r\n/**\r\n * NSFW Image Addon for Discord.\r\n *\r\n * This addon periodically fetches a random NSFW image from the waifu.pics API,\r\n * saves it to a local directory, and optionally sends it to configured NSFW channels.\r\n *\r\n * @see https://waifu.pics/\r\n * @author Hiroshi025\r\n * @version 2.0.0\r\n */\r\nexport default new Addons(\r\n  {\r\n    name: \"Nsfw Image Addon\",\r\n    description: \"Addon for sending NSFW images in Discord channels.\",\r\n    author: \"Hiroshi025\",\r\n    version: \"2.0.0\",\r\n    bitfield: [\"SendMessages\"],\r\n  },\r\n  async () => {\r\n    setInterval(async () => {\r\n      try {\r\n        // Primera parte: Guardado de imágenes (siempre activa)\r\n        await sendNSFWToChannels();\r\n        \r\n        // Segunda parte: Envío a canales (depende de config.enabled)\r\n        if (config.enabled) {\r\n          await saveRandomNSFWImage();\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error en el addon NSFW:\", error);\r\n      }\r\n    }, config.time);\r\n  },\r\n);\r\n\r\n/**\r\n * Saves a random NSFW image to the local directory.\r\n * This operation is independent of the config.enabled setting.\r\n */\r\nasync function saveRandomNSFWImage(): Promise<void> {\r\n  const random = [\"waifu\", \"neko\", \"blowjob\"] as const;\r\n  const url = config.url;\r\n  const imageType = random[Math.floor(Math.random() * random.length)];\r\n  const image = `${url}${imageType}`;\r\n\r\n  // Fetch image metadata\r\n  const res = await fetch(image);\r\n  if (!res.ok) throw new Error(`Error fetching image: ${res.statusText}`);\r\n\r\n  const data = await res.json();\r\n  \r\n  // Ensure directory exists\r\n  fs.mkdirSync(config.path, { recursive: true });\r\n\r\n  // Determine next file number\r\n  const files = fs.readdirSync(config.path);\r\n  const fileNumber = files.length;\r\n  const filePath = `${config.path}/nsfw-image-${fileNumber}.jpg`;\r\n\r\n  // Download and save image\r\n  const response = await fetch(data.url);\r\n  const arrayBuffer = await response.arrayBuffer();\r\n  const buffer = Buffer.from(arrayBuffer);\r\n  fs.writeFileSync(filePath, buffer);\r\n}\r\n\r\n/**\r\n * Sends NSFW images to configured Discord channels.\r\n * Only sends if config.enabled is true.\r\n */\r\nasync function sendNSFWToChannels(): Promise<void> {\r\n  const guilds = await main.prisma.myGuild.findMany({\r\n    select: { nsfwChannel: true },\r\n  });\r\n\r\n  for (const guild of guilds) {\r\n    if (!guild.nsfwChannel && guild.nsfwChannel === null) return;\r\n    const random = [\"waifu\", \"neko\", \"blowjob\"] as const;\r\n    const url = config.url;\r\n    const imageType = random[Math.floor(Math.random() * random.length)];\r\n    const image = `${url}${imageType}`;\r\n\r\n    // Fetch image metadata\r\n    const res = await fetch(image);\r\n    if (!res.ok) throw new Error(`Error fetching image: ${res.statusText}`);\r\n\r\n    const data = await res.json();\r\n    const response = await fetch(data.url);\r\n    if (!response.ok) throw new Error(`Error downloading image: ${response.statusText}`);\r\n\r\n    const channel = await client.channels.cache.get(guild.nsfwChannel);\r\n    if (channel?.type === ChannelType.GuildText) {\r\n      await channel.send({ content: data.url });\r\n    }\r\n  }\r\n}"],"names":[],"mappings":"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","debug_id":"0b1c8629-bb0e-5429-b3bd-0a68aafad959"}