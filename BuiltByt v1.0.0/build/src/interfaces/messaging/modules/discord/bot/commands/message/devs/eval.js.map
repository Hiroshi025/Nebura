{"version":3,"file":"eval.js","sources":["src/interfaces/messaging/modules/discord/bot/commands/message/devs/eval.ts"],"sourceRoot":"/","sourcesContent":["import { ChannelType } from \"discord.js\";\r\nimport { performance } from \"perf_hooks\";\r\nimport { inspect } from \"util\";\r\n\r\nimport {\r\n\tcreateDebugInfo, parseInput, sendError, sendResponse\r\n} from \"@/interfaces/messaging/modules/discord/structure/utils/functions\";\r\nimport { logWithLabel } from \"@/shared/utils/functions/console\";\r\nimport { Precommand } from \"@typings/modules/discord\";\r\n\r\nconst EvalCommand: Precommand = {\r\n  name: \"eval\",\r\n  description: \"Evaluates JavaScript code with advanced features\",\r\n  examples: [\"eval client.user.tag\", \"eval --async await fetch('...')\"],\r\n  nsfw: false,\r\n  owner: true,\r\n  permissions: [\"SendMessages\"],\r\n  cooldown: 10,\r\n  aliases: [\"e\", \"evaluate\"],\r\n  botpermissions: [\"SendMessages\", \"AttachFiles\"],\r\n  async execute(_client, message, args, prefix) {\r\n    if (!message.guild || !message.channel || message.channel.type !== ChannelType.GuildText) {\r\n      return;\r\n    }\r\n\r\n    // Parse flags and code\r\n    const { flags, code } = await parseInput(args);\r\n    if (!code) {\r\n      return await sendError(message, \"No code provided\", prefix);\r\n    }\r\n\r\n    try {\r\n      // Prepare evaluation context\r\n      //const context = await createEvalContext(client, message);\r\n      const startTime = performance.now();\r\n      const hrStart = process.hrtime();\r\n\r\n      // Execute the code\r\n      let evaluated;\r\n      if (flags.async) {\r\n        evaluated = await eval(`(async () => { ${code} })()`);\r\n      } else {\r\n        evaluated = eval(code);\r\n      }\r\n\r\n      // Handle promises\r\n      if (evaluated instanceof Promise) {\r\n        evaluated = await evaluated;\r\n      }\r\n\r\n      const executionTimeMs = performance.now() - startTime;\r\n      const hrEnd = process.hrtime(hrStart);\r\n      const executionTimeSec = `${hrEnd[0]}.${Math.floor(hrEnd[1] / 1e6)}s`;\r\n\r\n      // Process the output\r\n      const output = inspect(evaluated, {\r\n        depth: flags.deep ? null : 0,\r\n        colors: false,\r\n        maxArrayLength: flags.full ? null : 100,\r\n      });\r\n\r\n      // Create debug info\r\n      const debugInfo = await createDebugInfo({\r\n        code,\r\n        output,\r\n        executionTimeMs,\r\n        executionTimeSec,\r\n        type: typeof evaluated,\r\n        flags,\r\n        user: message.author,\r\n        channel: message.channel,\r\n        guild: message.guild,\r\n      });\r\n\r\n      // Prepare response\r\n      return await sendResponse(message, {\r\n        code,\r\n        output,\r\n        debugInfo,\r\n        executionTimeMs,\r\n        executionTimeSec,\r\n        type: typeof evaluated,\r\n        evaluated,\r\n        flags,\r\n      });\r\n    } catch (error: any) {\r\n      logWithLabel(\"error\", `Error in eval command: ${error}`);\r\n      console.error(error);\r\n\r\n      return await sendError(message, error, prefix, code);\r\n    }\r\n  },\r\n};\r\n\r\nexport = EvalCommand;\r\n"],"names":[],"mappings":"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","debug_id":"7fc80cb3-5fc0-5073-afd6-9a37b0ac4c25"}