{"version":3,"file":"download.js","sources":["src/interfaces/messaging/modules/discord/bot/interactions/modals/help/download.ts"],"sourceRoot":"/","sourcesContent":["import { AttachmentBuilder } from \"discord.js\";\r\nimport { readdirSync, readFileSync, statSync } from \"fs\";\r\nimport { join } from \"path\";\r\n\r\nimport { EmbedCorrect, ErrorEmbed } from \"@/shared/adapters/extends/embeds.extend\";\r\nimport { Modals } from \"@typings/modules/discord\";\r\nimport { config } from \"@utils/config\";\r\nimport { logWithLabel } from \"@utils/functions/console\";\r\n\r\nfunction getCommandsFromFolder(path: string): string[] {\r\n  let commands: string[] = [];\r\n  try {\r\n    const files = readdirSync(path);\r\n\r\n    for (const file of files) {\r\n      const fullPath = join(path, file);\r\n      if (statSync(fullPath).isDirectory()) {\r\n        commands = commands.concat(getCommandsFromFolder(fullPath));\r\n      } else if (file.endsWith(\".ts\") || file.endsWith(\".js\")) {\r\n        const name = file.replace(/\\.(ts|js)/, \"\");\r\n        commands.push(name);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    logWithLabel(\"error\", [`Error reading commands from folder: ${path}`, `Error: ${error}`].join(\"\\n\"));\r\n  }\r\n  return commands;\r\n}\r\n\r\nconst ModalDownloadCommand: Modals = {\r\n  id: \"download_command_modal\",\r\n  tickets: false,\r\n  owner: true,\r\n  permissions: [\"SendMessages\"],\r\n  botpermissions: [\"SendMessages\"],\r\n  async execute(interaction, client) {\r\n    if (!interaction.guild || !interaction.channel) return;\r\n    const commandName = interaction.fields.getTextInputValue(\"command_to_download\");\r\n    const categories = readdirSync(\r\n      config.modules.discord.configs.default + config.modules.discord.configs.paths.precommands,\r\n    );\r\n\r\n    try {\r\n      let found = false;\r\n      let fileContent = \"\";\r\n\r\n      for (const category of categories) {\r\n        const categoryPath = `${config.modules.discord.configs.default + config.modules.discord.configs.paths.precommands}${category}`;\r\n        const commands = getCommandsFromFolder(categoryPath);\r\n\r\n        if (commands.includes(commandName)) {\r\n          const filePath = join(categoryPath, `${commandName}.ts`);\r\n          fileContent = readFileSync(filePath, \"utf-8\");\r\n          found = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (found) {\r\n        const attachment = new AttachmentBuilder(Buffer.from(fileContent), {\r\n          name: `${commandName}.ts`,\r\n          description: `Source code for ${commandName} command`,\r\n        });\r\n\r\n        await interaction.reply({\r\n          embeds: [\r\n            new EmbedCorrect().setDescription(\r\n              [\r\n                `${client.getEmoji(interaction.guild.id, \"correct\")} Command \\`${commandName}\\` downloaded successfully.`,\r\n                `**Command:** \\`${commandName}\\` `,\r\n              ].join(\"\\n\"),\r\n            ),\r\n          ],\r\n          files: [attachment],\r\n          flags: \"Ephemeral\",\r\n        });\r\n      } else {\r\n        await interaction.reply({\r\n          embeds: [\r\n            new ErrorEmbed().setDescription(\r\n              [\r\n                `${client.getEmoji(interaction.guild.id, \"error\")} Command \\`${commandName}\\` not found.`,\r\n                `**Command:** \\`${commandName}\\` not found in the system.`,\r\n              ].join(\"\\n\"),\r\n            ),\r\n          ],\r\n          flags: \"Ephemeral\",\r\n        });\r\n      }\r\n    } catch (error) {\r\n      await interaction.reply({\r\n        embeds: [\r\n          new ErrorEmbed().setDescription(\r\n            [\r\n              `${client.getEmoji(interaction.guild.id, \"error\")} An error occurred while trying to download the command.`,\r\n              `**Command:** \\`${commandName}\\``,\r\n              `Error: ${error}`,\r\n            ].join(\"\\n\"),\r\n          ),\r\n        ],\r\n        flags: \"Ephemeral\",\r\n      });\r\n    }\r\n  },\r\n};\r\n\r\nexport = ModalDownloadCommand;\r\n"],"names":[],"mappings":"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","debug_id":"3747d263-d671-57ac-b375-66853b422ec9"}