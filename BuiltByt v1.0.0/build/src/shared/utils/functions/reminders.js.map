{"version":3,"file":"reminders.js","sources":["src/shared/utils/functions/reminders.ts"],"sourceRoot":"/","sourcesContent":["import { scheduleJob } from \"node-schedule\";\r\n\r\nimport { client, main } from \"@/main\";\r\nimport { EmbedCorrect } from \"@/shared/adapters/extends/embeds.extend\";\r\n\r\n/**\r\n * Loads pending reminders from the database and schedules them.\r\n *\r\n * This function retrieves reminders that have not been sent and are scheduled for a future time.\r\n * It uses the `node-schedule` library to schedule the reminders and sends them to the respective users.\r\n */\r\nexport async function loadPendingReminders(): Promise<void> {\r\n  const pendingReminders = await main.prisma.reminder.findMany({\r\n    where: {\r\n      isSent: false,\r\n      remindAt: { gte: new Date() },\r\n    },\r\n  });\r\n\r\n  for (const reminder of pendingReminders) {\r\n    scheduleJob(new Date(reminder.remindAt), async () => {\r\n      const member = await client.guilds.cache.get(reminder.guildId)?.members.fetch(reminder.userId);\r\n\r\n      if (member) {\r\n        await member\r\n          .send({\r\n            embeds: [new EmbedCorrect().setTitle(`Reminder!`).setDescription(reminder.message)],\r\n          })\r\n          .catch(() => {});\r\n\r\n        await main.prisma.reminder.update({\r\n          where: { id: reminder.id },\r\n          data: { isSent: true },\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAWA,oDA0BC;AArCD,iDAA4C;AAE5C,iCAAsC;AACtC,2EAAuE;AAEvE;;;;;GAKG;AACI,KAAK,UAAU,oBAAoB;IACxC,MAAM,gBAAgB,GAAG,MAAM,WAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;QAC3D,KAAK,EAAE;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,EAAE,GAAG,EAAE,IAAI,IAAI,EAAE,EAAE;SAC9B;KACF,CAAC,CAAC;IAEH,KAAK,MAAM,QAAQ,IAAI,gBAAgB,EAAE,CAAC;QACxC,IAAA,2BAAW,EAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,KAAK,IAAI,EAAE;YAClD,MAAM,MAAM,GAAG,MAAM,aAAM,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YAE/F,IAAI,MAAM,EAAE,CAAC;gBACX,MAAM,MAAM;qBACT,IAAI,CAAC;oBACJ,MAAM,EAAE,CAAC,IAAI,4BAAY,EAAE,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;iBACpF,CAAC;qBACD,KAAK,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;gBAEnB,MAAM,WAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;oBAChC,KAAK,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE;oBAC1B,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE;iBACvB,CAAC,CAAC;YACL,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;AACH,CAAC","debug_id":"92ba5c29-066e-5c1d-b6b5-7b3897dd1843"}