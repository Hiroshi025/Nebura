{"version":3,"file":"ips.routes.test.js","sources":["__test__/ips.routes.test.ts"],"sourceRoot":"/","sourcesContent":["jest.mock(\"discord.js\", () => ({\r\n  EmbedBuilder: class {},\r\n  ChannelType: {\r\n    GuildText: \"GuildText\",\r\n    PublicThread: \"PublicThread\",\r\n    PrivateThread: \"PrivateThread\",\r\n    AnnouncementThread: \"AnnouncementThread\",\r\n    // Agrega aquí otros tipos si tu código los usa\r\n  },\r\n}));\r\n\r\njest.mock(\"../src/interfaces/http/middlewares/jwt/token.middleware\", () => ({\r\n  authenticateToken: jest.fn((_req, _res, next) => next()),\r\n}));\r\njest.mock(\"../src/interfaces/http/middlewares/jwt/auth.middleware\", () => ({\r\n  isAdmin: jest.fn((_req, _res, next) => next()),\r\n}));\r\njest.mock(\"../src/interfaces/http/controllers/admin/ip.controllers\", () => ({\r\n  unblockIP: jest.fn(),\r\n  listBlockedIPs: jest.fn(),\r\n  blockIP: jest.fn(),\r\n}));\r\n\r\nimport registerIPSRoutes from \"../src/interfaces/http/routes/api/admin/ips.routes\";\r\nimport { RateLimitManager } from \"../src/interfaces/messaging/broker/rateLimit\";\r\n\r\nconst mockCreateCustomLimiter = jest.fn(() => \"rateLimiter\");\r\nconst mockGetInstance = jest.fn(() => ({\r\n  createCustomLimiter: mockCreateCustomLimiter,\r\n}));\r\nRateLimitManager.getInstance = mockGetInstance as unknown as () => RateLimitManager;\r\n\r\ndescribe(\"ips.routes\", () => {\r\n  let app: any;\r\n\r\n  beforeEach(() => {\r\n    app = {\r\n      delete: jest.fn(),\r\n      get: jest.fn(),\r\n      post: jest.fn(),\r\n    };\r\n    mockCreateCustomLimiter.mockClear();\r\n    app.delete.mockClear();\r\n    app.get.mockClear();\r\n    app.post.mockClear();\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n    jest.resetModules();\r\n  });\r\n\r\n  it(\"should register DELETE /api/v1/admin/unblock-ip/:ipAddress route with correct middlewares\", () => {\r\n    registerIPSRoutes({ app });\r\n\r\n    expect(app.delete).toHaveBeenCalledWith(\r\n      \"/api/v1/admin/unblock-ip/:ipAddress\",\r\n      \"rateLimiter\",\r\n      expect.any(Function), // authenticateToken\r\n      expect.any(Function), // isAdmin\r\n      expect.any(Function), // unblockIP\r\n    );\r\n    expect(mockCreateCustomLimiter).toHaveBeenCalledWith({\r\n      max: 10,\r\n      windowMs: 60 * 1000,\r\n      message: \"Too many requests, please try again later.\",\r\n    });\r\n  });\r\n\r\n  it(\"should register GET /api/v1/admin/blocked-ips route with correct middlewares\", () => {\r\n    registerIPSRoutes({ app });\r\n\r\n    expect(app.get).toHaveBeenCalledWith(\r\n      \"/api/v1/admin/blocked-ips\",\r\n      \"rateLimiter\",\r\n      expect.any(Function), // authenticateToken\r\n      expect.any(Function), // isAdmin\r\n      expect.any(Function), // listBlockedIPs\r\n    );\r\n    expect(mockCreateCustomLimiter).toHaveBeenCalledWith({\r\n      max: 10,\r\n      windowMs: 60 * 1000,\r\n      message: \"Too many requests, please try again later.\",\r\n    });\r\n  });\r\n\r\n  it(\"should register POST /api/v1/admin/block-ip route with correct middlewares\", () => {\r\n    registerIPSRoutes({ app });\r\n\r\n    expect(app.post).toHaveBeenCalledWith(\r\n      \"/api/v1/admin/block-ip\",\r\n      \"rateLimiter\",\r\n      expect.any(Function), // authenticateToken\r\n      expect.any(Function), // isAdmin\r\n      expect.any(Function), // blockIP\r\n    );\r\n    expect(mockCreateCustomLimiter).toHaveBeenCalledWith({\r\n      max: 10,\r\n      windowMs: 60 * 1000,\r\n      message: \"Too many requests, please try again later.\",\r\n    });\r\n  });\r\n\r\n  it(\"should call RateLimitManager.getInstance only three times\", () => {\r\n    registerIPSRoutes({ app });\r\n    expect(mockGetInstance).toHaveBeenCalledTimes(3);\r\n    expect(mockCreateCustomLimiter).toHaveBeenCalledTimes(3);\r\n  });\r\n});\r\n"],"names":[],"mappings":"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","debug_id":"122722fb-190b-51b8-a449-f5c179e8bbc5"}