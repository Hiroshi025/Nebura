<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Página de error - Nebura CDN">
  <meta name="author" content="Nebura">
  <title>
    <%- title ? title : 'Nebura - Error' %>
  </title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="/css/error.css">
</head>

<body>
  <header class="navbar navbar-expand-lg position-relative">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">
        <i class="fas fa-server me-2" style="color: #6a5af9;"></i>Nebura
      </a>
      <!-- Controles de idioma y tema -->
      <div class="top-controls">
        <div class="language-switcher">
          <a href="#" class="lang-link" data-lang="es">ES</a>
          <span>|</span>
          <a href="#" class="lang-link" data-lang="en">EN</a>
        </div>
        <div class="form-check form-switch theme-switcher">
          <input class="form-check-input" type="checkbox" role="switch" id="themeSwitch" title="Cambiar tema">
          <label class="form-check-label" for="themeSwitch"><i class="fas fa-moon"></i></label>
        </div>
      </div>
    </div>
  </header>

  <main class="container py-5 flex-grow-1">
    <div class="error-container">
      <div class="error-card">
        <i class="fas fa-exclamation-triangle error-icon"></i>
        <h1 class="error-title" id="error-title">Error 404</h1>
        <div class="error-code" id="error-code">ERR_FILE_NOT_FOUND</div>
        <p class="error-description" id="error-description">
          El archivo que estás buscando no existe o ha sido eliminado.
        </p>
        <a href="/dashboard" class="btn-home" id="btn-home">
          <i class="fas fa-home me-2"></i> <span data-key="homeBtn">Volver al inicio</span>
        </a>
        <div class="error-details" id="error-details" style="display: none;">
          <h3 class="error-details-title" data-key="techDetailsTitle">Detalles técnicos</h3>
          <div class="error-details-content" id="error-details-content"></div>
        </div>
      </div>
    </div>
  </main>

  <footer class="text-center py-4 text-muted">
    <small>© 2025 Nebura. Todos los derechos reservados.</small>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // --- SISTEMA DE IDIOMAS Y TEMA ---
    const translations = {
      es: {
        error404: "Error 404 - No encontrado",
        error404Desc: "El recurso solicitado no existe o ha sido eliminado.",
        error403: "Error 403 - Acceso denegado",
        error403Desc: "No tienes permiso para acceder a este recurso.",
        error500: "Error 500 - Error del servidor",
        error500Desc: "Ocurrió un error inesperado en el servidor.",
        error400: "Error 400 - Solicitud incorrecta",
        error400Desc: "La solicitud enviada al servidor no es válida.",
        timeout: "Error - Tiempo de espera agotado",
        timeoutDesc: "La operación tardó demasiado tiempo en completarse.",
        homeBtn: "Volver al inicio",
        techDetailsTitle: "Detalles técnicos"
      },
      en: {
        error404: "Error 404 - Not found",
        error404Desc: "The requested resource does not exist or has been removed.",
        error403: "Error 403 - Access denied",
        error403Desc: "You do not have permission to access this resource.",
        error500: "Error 500 - Server error",
        error500Desc: "An unexpected error occurred on the server.",
        error400: "Error 400 - Bad request",
        error400Desc: "The request sent to the server is invalid.",
        timeout: "Error - Timeout",
        timeoutDesc: "The operation took too long to complete.",
        homeBtn: "Back to home",
        techDetailsTitle: "Technical details"
      }
    };

    const themeSwitch = document.getElementById('themeSwitch');
    const themeIcon = document.querySelector('label[for="themeSwitch"] i');
    const htmlElement = document.documentElement;
    const langLinks = document.querySelectorAll('.lang-link');

    function setLanguage(lang) {
      const t = translations[lang];
      // Detectar tipo de error
      const params = new URLSearchParams(window.location.search);
      const type = params.get('type') || '404';
      const message = params.get('message');
      const code = params.get('code') || `ERR_${type.toUpperCase()}`;

      // Elementos
      const errorTitle = document.getElementById('error-title');
      const errorCode = document.getElementById('error-code');
      const errorDescription = document.getElementById('error-description');
      const btnHome = document.getElementById('btn-home');
      const techDetailsTitle = document.querySelector('.error-details-title');

      // Traducción de título y descripción
      switch (type) {
        case '404':
          errorTitle.textContent = t.error404;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.error404Desc;
          break;
        case '403':
          errorTitle.textContent = t.error403;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.error403Desc;
          break;
        case '500':
          errorTitle.textContent = t.error500;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.error500Desc;
          break;
        case '400':
          errorTitle.textContent = t.error400;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.error400Desc;
          break;
        case 'timeout':
          errorTitle.textContent = t.timeout;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.timeoutDesc;
          break;
        default:
          errorTitle.textContent = t.error404;
          errorDescription.textContent = message ? decodeURIComponent(message) : t.error404Desc;
      }
      errorCode.textContent = code;
      btnHome.querySelector('span[data-key="homeBtn"]').textContent = t.homeBtn;
      if (techDetailsTitle) techDetailsTitle.textContent = t.techDetailsTitle;

      // Actualizar idioma activo
      langLinks.forEach(link => {
        link.classList.toggle('active', link.getAttribute('data-lang') === lang);
      });
      document.documentElement.lang = lang;
      localStorage.setItem('language', lang);
    }

    function updateThemeIcon(theme) {
      themeIcon.classList.toggle('fa-moon', theme === 'light');
      themeIcon.classList.toggle('fa-sun', theme === 'dark');
    }

    function applyTheme(theme) {
      htmlElement.setAttribute('data-bs-theme', theme);
      themeSwitch.checked = theme === 'dark';
      updateThemeIcon(theme);
      localStorage.setItem('theme', theme);
    }

    langLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        setLanguage(link.getAttribute('data-lang'));
      });
    });

    themeSwitch.addEventListener('change', () => {
      const newTheme = themeSwitch.checked ? 'dark' : 'light';
      applyTheme(newTheme);
    });

    // --- Lógica de error (adaptada para idioma) ---
    document.addEventListener('DOMContentLoaded', function () {
      // Inicializar tema e idioma
      const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      applyTheme(savedTheme);
      const savedLang = localStorage.getItem('language') || (navigator.language.startsWith('en') ? 'en' : 'es');
      setLanguage(savedLang);

      // Mostrar detalles técnicos en entorno de desarrollo
      const params = new URLSearchParams(window.location.search);
      const errorDetails = document.getElementById('error-details');
      const errorDetailsContent = document.getElementById('error-details-content');
      function showTechnicalDetails() {
        const paramsObj = Object.fromEntries(params.entries());
        const details = {
          'URL': window.location.href,
          'User Agent': navigator.userAgent,
          'Plataforma': navigator.platform,
          'Fecha': new Date().toISOString(),
          'Parámetros': Object.keys(paramsObj).length > 0
            ? `<pre>${JSON.stringify(paramsObj, null, 2)}</pre>`
            : 'Ninguno'
        };
        let detailsText = '';
        for (const [key, value] of Object.entries(details)) {
          detailsText += `<strong>${key}:</strong> ${value}<br>`;
        }
        errorDetailsContent.innerHTML = detailsText;
        errorDetails.style.display = 'block';
      }
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        showTechnicalDetails();
      }
    });
  </script>
</body>

</html>